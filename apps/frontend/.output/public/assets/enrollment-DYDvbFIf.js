import{r as s,j as t,B as i,S as Q,t as C}from"./main-CH1Vho1T.js";import{g as V,d as W,C as v,a as j,b as N,c as y,B as p,e as X,f as Y}from"./api-DSxyYvsI.js";import{L as A,I as E}from"./label-CjK28Nm6.js";import{A as Z,a as ee,b as te,c as se,d as ae,e as ne,f as re,g as ie,h as le}from"./alert-dialog-DacxVlWJ.js";function me(){const[c,U]=s.useState([]),[I,w]=s.useState(!0),[b,m]=s.useState(null),[D,$]=s.useState("24"),[S,H]=s.useState(!1),[u,B]=s.useState(null),[a,x]=s.useState("all"),[k,z]=s.useState(null),[T,_]=s.useState("");s.useEffect(()=>{h(),G()},[]);async function G(){try{const e=await V();e.serverHost&&_(e.serverHost)}catch(e){console.error("Failed to fetch server host:",e)}}s.useEffect(()=>{h()},[]);async function h(){try{w(!0),m(null);const e=await W(!0);U(e)}catch(e){m(e instanceof Error?e:new Error("Failed to fetch enrollment codes"))}finally{w(!1)}}async function O(){try{H(!0),m(null);const e=parseInt(D,10)||24,l=await X(e);B(l.code),await h()}catch(e){m(e instanceof Error?e:new Error("Failed to create enrollment code"))}finally{H(!1)}}function f(e){return new Date(e).toLocaleString()}function o(e){return Date.now()>e.expiresAt}function n(e){return e.usedAt!==null}function r(e){return e.deactivatedAt!==null}function F(){if(T){const l=window.location.port||"3001";return`http://${T}:${l}`}return window.location.origin.replace(/:\d+$/,":3001")}async function R(e){try{await navigator.clipboard.writeText(e)}catch{const d=document.createElement("textarea");d.value=e,d.style.position="fixed",d.style.opacity="0",document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d)}}async function g(e,l){await R(l),C.success(`${e==="code"?"Enrollment code":e} copied to clipboard`)}const L=c.filter(e=>a==="active"?!n(e)&&!o(e)&&!r(e):a==="used"?n(e):a==="expired"?o(e)&&!n(e)&&!r(e):a==="deactivated"?r(e):!0),P=c.filter(e=>!n(e)&&!o(e)&&!r(e)).length,q=c.filter(e=>n(e)).length,J=c.filter(e=>o(e)&&!n(e)&&!r(e)).length,K=c.filter(e=>r(e)).length;async function M(e){try{z(e),await Y(e),C.success("Enrollment code deactivated"),await h()}catch(l){C.error(l instanceof Error?l.message:"Failed to deactivate enrollment code")}finally{z(null)}}return I?t.jsx("div",{className:"container mx-auto p-4",children:t.jsx("div",{className:"text-center",children:"Loading enrollment codes..."})}):t.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-medium mb-2",children:"Enrollment Codes"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Generate and manage enrollment codes for Home Assistant instances"})]}),b&&t.jsx(v,{children:t.jsx(j,{className:"py-4 text-destructive",children:b.message})}),t.jsxs(v,{children:[t.jsx(N,{children:t.jsx(y,{className:"text-sm",children:"Generate New Code"})}),t.jsxs(j,{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(A,{htmlFor:"expires",children:"Expires In (hours)"}),t.jsx(E,{id:"expires",type:"number",value:D,onChange:e=>$(e.target.value),min:"1",max:"168"})]}),t.jsx(i,{onClick:O,disabled:S,children:S?"Creating...":"Generate Code"}),u&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"p-4 bg-muted rounded border",children:[t.jsx("p",{className:"text-sm font-medium mb-2",children:"New Enrollment Code:"}),t.jsx("p",{className:"text-2xl font-mono font-bold",children:u}),t.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Share this code with the Home Assistant instance to enroll"})]}),t.jsxs(v,{children:[t.jsx(N,{children:t.jsx(y,{className:"text-sm",children:"Add-on Configuration"})}),t.jsxs(j,{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Copy these values into your Home Assistant add-on configuration:"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(A,{className:"text-xs font-medium",children:"server_url"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{readOnly:!0,value:F(),className:"font-mono text-sm"}),t.jsx(i,{size:"sm",variant:"outline",onClick:()=>g("server_url",F()),children:"Copy"})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"The full URL of your Omnii server (include protocol and port)"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(A,{className:"text-xs font-medium",children:"enrollment_code"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(E,{readOnly:!0,value:u,className:"font-mono text-sm font-bold"}),t.jsx(i,{size:"sm",variant:"outline",onClick:()=>g("enrollment_code",u),children:"Copy"})]}),t.jsx("p",{className:"text-xs text-muted-foreground",children:"The 6-digit enrollment code generated above"})]})]})]})]})]})]}),t.jsxs(v,{children:[t.jsx(N,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(y,{className:"text-sm",children:"Enrollment Codes"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs(i,{variant:a==="all"?"default":"outline",size:"sm",onClick:()=>x("all"),className:"text-xs",children:["All (",c.length,")"]}),t.jsxs(i,{variant:a==="active"?"default":"outline",size:"sm",onClick:()=>x("active"),className:"text-xs",children:["Active (",P,")"]}),t.jsxs(i,{variant:a==="used"?"default":"outline",size:"sm",onClick:()=>x("used"),className:"text-xs",children:["Used (",q,")"]}),t.jsxs(i,{variant:a==="expired"?"default":"outline",size:"sm",onClick:()=>x("expired"),className:"text-xs",children:["Expired (",J,")"]}),t.jsxs(i,{variant:a==="deactivated"?"default":"outline",size:"sm",onClick:()=>x("deactivated"),className:"text-xs",children:["Deactivated (",K,")"]})]})]})}),t.jsx(j,{children:L.length===0?t.jsx("div",{className:"text-center text-muted-foreground py-8",children:c.length===0?"No enrollment codes":`No ${a} enrollment codes`}):t.jsx("div",{className:"space-y-4",children:L.map(e=>t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"text-lg font-mono font-bold",children:e.code}),n(e)&&t.jsx(p,{variant:"secondary",children:"Used"}),r(e)&&t.jsx(p,{variant:"destructive",children:"Deactivated"}),o(e)&&!n(e)&&!r(e)&&t.jsx(p,{variant:"destructive",children:"Expired"}),!o(e)&&!n(e)&&!r(e)&&t.jsx(p,{variant:"default",children:"Active"})]}),t.jsxs("div",{className:"text-xs text-muted-foreground mt-1",children:["Created: ",f(e.createdAt)," | Expires: ",f(e.expiresAt)]}),e.usedAt&&t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Used: ",f(e.usedAt)]}),e.deactivatedAt&&t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Deactivated: ",f(e.deactivatedAt)]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[!n(e)&&!r(e)&&!o(e)&&t.jsxs(Z,{children:[t.jsx(ee,{asChild:!0,children:t.jsx(i,{size:"sm",variant:"destructive",disabled:k===e.id,children:k===e.id?"Deactivating...":"Deactivate"})}),t.jsxs(te,{children:[t.jsxs(se,{children:[t.jsx(ae,{children:"Deactivate Enrollment Code"}),t.jsxs(ne,{children:["Are you sure you want to deactivate code ",t.jsx("strong",{children:e.code}),"? This will make it unavailable for enrollment immediately."]})]}),t.jsxs(re,{children:[t.jsx(ie,{children:"Cancel"}),t.jsx(le,{onClick:()=>M(e.id),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"Deactivate"})]})]})]}),t.jsx(i,{size:"sm",variant:"outline",onClick:()=>g("code",e.code),children:"Copy"})]})]}),t.jsx(Q,{})]},e.id))})})]})]})}export{me as component};
