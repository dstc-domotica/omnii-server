import{r as x,a as w,j as e,B as p,L as y,t as D}from"./main-CH1Vho1T.js";import{h as b,C as u,b as f,c as m,B as C,a as h,i as I}from"./api-DSxyYvsI.js";import{w as A,D as S,a as M,o as E,b as L,c as N,d as O,r as T}from"./dropdown-menu-C862ohpL.js";import{A as $,b as k,c as z,d as B,e as F,f as H,g as V,h as _}from"./alert-dialog-DacxVlWJ.js";function J(){const[s,l]=x.useState([]),[c,r]=x.useState(!0),[n,t]=x.useState(null),i=x.useCallback(async()=>{try{r(!0),t(null);const d=await b();l(d)}catch(d){t(d instanceof Error?d:new Error("Failed to fetch instances"))}finally{r(!1)}},[]);return x.useEffect(()=>(i(),A.onMessage(a=>{a.type==="instance_deleted"?l(o=>o.filter(j=>j.id!==a.instanceId)):(a.type==="status_change"||a.type==="heartbeat"||a.type==="metrics")&&l(o=>{const j=o.findIndex(g=>g.id===a.instanceId);return j!==-1&&a.data.instance?o.map((g,v)=>v===j?a.data.instance:g):o})})),[i]),{instances:s,loading:c,error:n,refetch:i}}function P(s){if(!s)return"Never";const l=new Date(s),r=Date.now()-s,n=Math.floor(r/1e3),t=Math.floor(n/60),i=Math.floor(t/60);return n<60?"Just now":t<60?`${t}m ago`:i<24?`${i}h ago`:l.toLocaleDateString()}function R(s){switch(s){case"online":return"default";case"offline":return"secondary";case"error":return"destructive";default:return"outline"}}function q({instance:s,onDelete:l}){const c=w(),[r,n]=x.useState(!1),[t,i]=x.useState(!1),d=async a=>{if(a.preventDefault(),!r)try{n(!0),await I(s.id),i(!1),D.success(`Instance "${s.name}" deleted successfully`),l&&l()}catch(o){console.error("Failed to delete instance:",o),D.error("Failed to delete instance. Please try again.")}finally{n(!1)}};return e.jsxs(u,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(m,{className:"text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["ID: ",s.id]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:R(s.status),children:s.status}),e.jsxs(S,{children:[e.jsx(M,{render:e.jsx(p,{variant:"ghost",size:"sm",className:"h-7 w-7 p-0"}),children:e.jsx(E,{className:"size-4"})}),e.jsxs(L,{align:"end",children:[e.jsx(N,{onSelect:a=>{a.preventDefault(),c({to:"/instances/$id",params:{id:s.id}})},children:"View Details"}),e.jsx(O,{}),e.jsxs(N,{variant:"destructive",onClick:()=>{i(!0)},children:[e.jsx(T,{className:"size-4 mr-2"}),"Delete Instance"]})]})]})]})]})}),e.jsx($,{open:t,onOpenChange:i,children:e.jsxs(k,{children:[e.jsxs(z,{children:[e.jsx(B,{children:"Delete Instance"}),e.jsxs(F,{children:["Are you sure you want to delete ",e.jsx("strong",{children:s.name}),"? This action cannot be undone and will delete all associated data including metrics and heartbeats."]})]}),e.jsxs(H,{children:[e.jsx(V,{disabled:r,children:"Cancel"}),e.jsx(_,{onClick:d,disabled:r,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:r?"Deleting...":"Delete"})]})]})}),e.jsxs(h,{children:[e.jsxs("div",{className:"space-y-2 text-xs",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last seen:"}),e.jsx("span",{children:P(s.lastSeen)})]}),s.enrolledAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Enrolled:"}),e.jsx("span",{children:new Date(s.enrolledAt).toLocaleDateString()})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(y,{to:"/instances/$id",params:{id:s.id},children:e.jsx(p,{variant:"outline",size:"sm",className:"w-full",children:"View Details"})})})]})]})}function W(){const{instances:s,loading:l,error:c,refetch:r}=J(),n={total:s.length,online:s.filter(t=>t.status==="online").length,offline:s.filter(t=>t.status==="offline").length,error:s.filter(t=>t.status==="error").length};return l?e.jsx("div",{className:"container mx-auto p-4",children:e.jsx("div",{className:"text-center",children:"Loading instances..."})}):c?e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs("div",{className:"text-destructive",children:["Error: ",c.message]})}):e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-medium mb-2",children:"Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Monitor all Home Assistant instances"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(m,{className:"text-xs",children:"Total Instances"})}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-medium",children:n.total})})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(m,{className:"text-xs",children:"Online"})}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-medium text-primary",children:n.online})})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(m,{className:"text-xs",children:"Offline"})}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-medium",children:n.offline})})]}),e.jsxs(u,{children:[e.jsx(f,{children:e.jsx(m,{className:"text-xs",children:"Error"})}),e.jsx(h,{children:e.jsx("div",{className:"text-2xl font-medium text-destructive",children:n.error})})]})]}),s.length===0?e.jsx(u,{children:e.jsx(h,{className:"py-8 text-center text-muted-foreground",children:"No instances enrolled yet"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(t=>e.jsx(q,{instance:t,onDelete:r},t.id))})]})}export{W as component};
