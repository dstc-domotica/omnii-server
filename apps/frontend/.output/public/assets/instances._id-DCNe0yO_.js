import{r as a,R as P,a as R,j as e,B as F,S as z,t as f}from"./main-CH1Vho1T.js";import{C as p,b as g,c as N,a as v,B as L,j as _,k as J,l as U,i as V,s as W}from"./api-DSxyYvsI.js";import{w as b,D as q,a as G,o as K,b as Q,c as X,r as Y}from"./dropdown-menu-C862ohpL.js";import{L as Z,I as ee}from"./label-CjK28Nm6.js";import{A as se,b as te,c as ae,d as ne,e as re,f as le,g as ie,h as ce}from"./alert-dialog-DacxVlWJ.js";function de(){const[n,o]=a.useState(!1),[t,m]=a.useState(null);return a.useEffect(()=>{b.connect();const u=b.onMessage(l=>{m(l),l.type==="status_change"&&l.instanceId===""&&o(l.data.connected)});return o(b.isConnected()),()=>{u()}},[]),{connected:n,lastMessage:t}}function je(){const{id:n}=P.useParams(),o=R(),[t,m]=a.useState(null),[u,l]=a.useState([]),[S,T]=a.useState([]),[$,D]=a.useState(!0),[C,w]=a.useState(null),[x,I]=a.useState(""),[A,M]=a.useState(!1),[h,E]=a.useState(!1),[k,y]=a.useState(!1),{lastMessage:i}=de();a.useEffect(()=>{async function s(){try{D(!0),w(null);const[r,d,j]=await Promise.all([_(n),J(n),U(n)]);m(r),l(d),T(j)}catch(r){w(r instanceof Error?r:new Error("Failed to fetch instance data"))}finally{D(!1)}}s()},[n]),a.useEffect(()=>{i&&i.instanceId===n&&i.data.instance&&m(i.data.instance)},[i,n]);const H=async()=>{if(x.trim())try{M(!0),await W(n,x),I(""),f.success("Command sent successfully")}catch(s){console.error("Failed to send command:",s),f.error("Failed to send command. Please try again.")}finally{M(!1)}},O=async s=>{if(s.preventDefault(),!h)try{E(!0),await V(n),y(!1),f.success(`Instance "${t?.name}" deleted successfully`),o({to:"/"})}catch(r){console.error("Failed to delete instance:",r),f.error("Failed to delete instance. Please try again.")}finally{E(!1)}};if($)return e.jsx("div",{className:"container mx-auto p-4",children:e.jsx("div",{className:"text-center",children:"Loading instance details..."})});if(C||!t)return e.jsx("div",{className:"container mx-auto p-4",children:e.jsxs("div",{className:"text-destructive",children:["Error: ",C?.message||"Instance not found"]})});function c(s){return new Date(s).toLocaleString()}function B(s){if(!s)return"N/A";const r=Math.floor(s/86400),d=Math.floor(s%86400/3600),j=Math.floor(s%3600/60);return r>0?`${r}d ${d}h`:d>0?`${d}h ${j}m`:`${j}m`}return e.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx("div",{children:e.jsx("h1",{className:"text-2xl font-medium mb-2",children:t.name})}),e.jsxs(q,{children:[e.jsx(G,{render:e.jsx(F,{variant:"outline",size:"sm"}),children:e.jsx(K,{className:"size-4"})}),e.jsx(Q,{align:"end",children:e.jsxs(X,{variant:"destructive",onClick:()=>{y(!0)},children:[e.jsx(Y,{className:"size-4 mr-2"}),"Delete Instance"]})})]}),e.jsx(se,{open:k,onOpenChange:y,children:e.jsxs(te,{children:[e.jsxs(ae,{children:[e.jsx(ne,{children:"Delete Instance"}),e.jsxs(re,{children:["Are you sure you want to delete ",e.jsx("strong",{children:t.name}),"? This action cannot be undone and will delete all associated data including metrics and heartbeats."]})]}),e.jsxs(le,{children:[e.jsx(ie,{disabled:h,children:"Cancel"}),e.jsx(ce,{onClick:O,disabled:h,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:h?"Deleting...":"Delete"})]})]})})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(N,{className:"text-sm",children:"Instance Information"})}),e.jsxs(v,{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status:"}),e.jsx(L,{variant:t.status==="online"?"default":t.status==="error"?"destructive":"secondary",children:t.status})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Seen:"}),e.jsx("span",{children:t.lastSeen?c(t.lastSeen):"Never"})]}),t.enrolledAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Enrolled:"}),e.jsx("span",{children:c(t.enrolledAt)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Created:"}),e.jsx("span",{children:c(t.createdAt)})]})]})]}),e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(N,{className:"text-sm",children:"Send Command"})}),e.jsxs(v,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Z,{htmlFor:"command",children:"Command"}),e.jsx(ee,{id:"command",value:x,onChange:s=>I(s.target.value),placeholder:"e.g., get_status, get_metrics"})]}),e.jsx(F,{onClick:H,disabled:A||!x.trim(),children:A?"Sending...":"Send Command"})]})]}),u.length>0&&e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(N,{className:"text-sm",children:"Latest Metrics"})}),e.jsx(v,{children:e.jsx("div",{className:"space-y-4",children:u.slice(0,5).map(s=>e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Timestamp:"}),e.jsx("span",{children:c(s.timestamp)})]}),s.uptimeSeconds!==null&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Uptime:"}),e.jsx("span",{children:B(s.uptimeSeconds)})]}),s.version&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Version:"}),e.jsx("span",{children:s.version})]}),s.stabilityScore!==null&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Stability:"}),e.jsxs("span",{children:[(s.stabilityScore*100).toFixed(1),"%"]})]}),s.metadata&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"text-muted-foreground text-xs",children:"Metadata:"}),e.jsx("pre",{className:"text-xs bg-muted p-2 rounded mt-1 overflow-auto",children:JSON.stringify(JSON.parse(s.metadata),null,2)})]}),e.jsx(z,{})]},s.id))})})]}),S.length>0&&e.jsxs(p,{children:[e.jsx(g,{children:e.jsx(N,{className:"text-sm",children:"Recent Heartbeats"})}),e.jsx(v,{children:e.jsx("div",{className:"space-y-2 text-sm",children:S.slice(0,10).map(s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-muted-foreground",children:c(s.timestamp)}),e.jsx(L,{variant:s.status==="online"?"default":"secondary",children:s.status})]},s.id))})})]})]})}export{je as component};
